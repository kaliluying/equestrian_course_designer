# 马术障碍赛路线设计器 - 技术设计文档

## 1. 系统架构

### 1.1 核心模块

#### 场地画布 (CourseCanvas)
- 负责渲染场地和障碍物
- 处理拖拽和交互
- 显示路线
- 使用 Canvas/SVG 实现高性能绘制

#### 工具栏 (ToolBar)
- 障碍物模板库
- 常用操作按钮
- 路线管理工具
- 设计方案导入导出

#### 状态管理
- CourseStore：管理课程设计状态
  - 障碍物列表
  - 当前路线
  - 画布状态
- UserStore：管理用户状态
  - 登录信息
  - 权限控制
  - 个人设置

### 1.2 数据模型

#### 障碍物 (Obstacle)
```typescript
interface Obstacle {
  id: string;           // 唯一标识
  type: ObstacleType;   // 障碍物类型
  position: Point;      // 位置坐标
  rotation: number;     // 旋转角度
  width: number;        // 宽度
  height: number;       // 高度
  properties: {         // 特殊属性
    color?: string;     // 颜色
    height?: number;    // 跳跃高度
    spread?: number;    // 横木间距
  }
}
```

#### 路线 (Route)
```typescript
interface Route {
  id: string;           // 唯一标识
  name: string;         // 路线名称
  points: Point[];      // 控制点
  obstacles: string[];  // 障碍物顺序
  metadata: {          // 元数据
    createdAt: Date;   // 创建时间
    updatedAt: Date;   // 更新时间
    author: string;    // 作者
  }
}
```

## 2. 功能模块设计

### 2.1 障碍物管理

#### 障碍物类型
- SINGLE: 单横木
- DOUBLE: 双横木
- COMBINATION: 组合障碍
- WALL: 砖墙
- LIVERPOOL: 利物浦

#### 核心功能
1. 障碍物创建
   - 从模板拖拽
   - 属性配置
   - 位置调整
2. 障碍物编辑
   - 移动和旋转
   - 属性修改
   - 删除操作
3. 障碍物验证
   - 位置合法性检查
   - 间距验证
   - 规则符合性检查

### 2.2 路线设计

#### 路线生成算法
1. 输入参数
   - 起点和终点
   - 必经障碍物
   - 场地限制
2. 约束条件
   - 最小转弯半径
   - 障碍物间距
   - 接近角度
3. 优化目标
   - 路线流畅度
   - 难度均衡
   - 美观性

#### 路线编辑功能
- 手动调整控制点
- 更改障碍物顺序
- 添加/删除路线点
- 路线样式设置

### 2.3 用户系统

#### 功能清单
1. 账户管理
   - 注册
   - 登录/登出
   - 密码重置
   - 个人信息维护
2. 设计管理
   - 保存设计
   - 加载设计
   - 设计分享
   - 版本控制
3. 权限控制
   - 访客权限
   - 用户权限
   - 管理员权限

## 3. 界面设计

### 3.1 布局结构
```
+------------------+
|     顶部导航     |
+--------+---------+
|        |         |
|工具栏  |  画布   |
|        |         |
|        |         |
+--------+---------+
|     状态栏       |
+------------------+
```

### 3.2 交互设计
1. 拖拽操作
   - 从工具栏拖动到画布
   - 画布内移动
   - 吸附对齐
2. 快捷键
   - Delete: 删除选中
   - Ctrl+Z: 撤销
   - Ctrl+Y: 重做
   - Space: 平移画布
3. 右键菜单
   - 复制/粘贴
   - 删除
   - 属性编辑
   - 锁定/解锁

## 4. 性能优化

### 4.1 渲染优化
- 使用 Canvas/WebGL 渲染
- 视口裁剪
- 图层管理
- 缓存机制

### 4.2 数据处理
- 数据分页
- 懒加载
- 增量更新
- 本地缓存

### 4.3 交互优化
- 防抖/节流
- 异步处理
- 批量更新
- 预加载

## 5. 安全性设计

### 5.1 数据安全
- HTTPS 传输
- 数据加密
- XSS 防护
- CSRF 防护

### 5.2 用户认证
- JWT 认证
- Session 管理
- 密码加密
- 权限校验

## 6. 测试策略

### 6.1 单元测试
- 组件测试
- 工具函数测试
- 状态管理测试

### 6.2 集成测试
- 功能流程测试
- API 接口测试
- 性能测试

### 6.3 E2E 测试
- 用户操作流程
- 跨浏览器测试
- 响应式布局测试 